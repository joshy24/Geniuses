var myApp=angular.module("geniuses",["ui.router","timer"]);window.fbAsyncInit=function(){FB.init({appId:"1152198031480823",xfbml:!0,version:"v2.5"})},function(e,t,a){var n,s=e.getElementsByTagName(t)[0];e.getElementById(a)||(n=e.createElement(t),n.id=a,n.src="//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.6&appId=1152198031480823",s.parentNode.insertBefore(n,s))}(document,"script","facebook-jssdk"),myApp.config(["$stateProvider","$urlRouterProvider","$locationProvider",function(e,t,a){t.otherwise("/home"),e.state("login",{url:"/",controller:"LoginController",templateUrl:"templates/login.html",authenticated:!1}).state("home",{url:"/home",controller:"TimelineController",templateUrl:"templates/timeline.html",authenticated:!0}).state("loginerror",{url:"/loginerror",controller:"LoginController",templateUrl:"templates/error.html",authenticated:!0}).state("profile",{url:"/profile",controller:"ProfileController",templateUrl:"templates/profile.html",authenticated:!0}).state("friends",{url:"/friends",controller:"friendsController",templateUrl:"templates/friends.html",authenticated:!0}).state("user",{url:"/user",controller:"userProfileController",templateUrl:"templates/user.html",params:{id:null},authenticated:!0}).state("examparameters",{url:"/examparameters",controller:"examParameterController",templateUrl:"templates/examParameters.html",authenticated:!0}).state("exam",{url:"/exam",controller:"examController",templateUrl:"templates/exam.html",params:{exam:null},authenticated:!0}).state("result",{url:"/result",controller:"resultController",templateUrl:"templates/examresult.html",params:{result:null},authenticated:!0}).state("post",{url:"/post/:pid",controller:"postController",templateUrl:"templates/post.html",authenticated:!1}).state("terms",{url:"/terms",controller:"termsController",templateUrl:"templates/terms.html",authenticated:!1}),a.html5Mode(!0)}]),myApp.run(["$rootScope","$state","$location","authService",function(e,t,a,n){e.$on("$stateChangeStart",function(e,a,s,r,o){if(n.isLoggedIn());else if(a.authenticated===!0)return e.preventDefault(),t.go("login")})}]),myApp.controller("termsController",["$scope","$state","authService",function(e,t,a){e.isLoggedIn=a.isLoggedIn(),$(".spinner-div").hide(),$(".horizontal-menu").hide(),e.goLogin=function(){t.go("login")}}]),myApp.controller("postController",["$scope","$stateParams","externalpost","getExternalPost","authService",function(e,t,a,n,s){s.isLoggedIn()?e.loggedIn=!0:e.loggedIn=!1;var r=t.pid;n.getPost(r)}]),myApp.controller("LoginController",["$q","$scope","$rootScope","$http","$state","currentUser","login","service","showAbout","responseReview","getSchools","authService","service",function(e,t,a,n,s,r,o,i,l,u,d,c,i){function w(e){return!e||0===e.length}c.isLoggedIn()&&s.go("home"),t.showQuickAbout=function(){l.showAbout()},$(".horizontal-menu").hide(),$(".spinner-div").hide(),$(".imgpanel").hide(),t.error=!1;var f=0;t.unknown_error=!1,t.age_error=!1,d.getSchoolsHttp("endpoints/schools.php").then(function(e){var a=e.data.schools;t.schools=a.sort()},function(e){}),t.setSchoolMail=function(e){t.signupmail.school=t.schools[e]},t.setSchool=function(e){t.signup.school=t.schools[e]},$("#fb-signin-request-modal").on("hide.bs.modal",function(){window.location.assign(window.location.href)}),t.FBlogin=function(){$(".spinner-div").show(),FB.getLoginStatus(function(e){"connected"===e.status?m():"not_authorized"===e.status?FB.login(function(e){e.authResponse?m():$("#fb-signin-request-modal").modal("show")}):FB.login(function(e){e.authResponse?m():$("#fb-signin-request-modal").modal("show")})})};var m=function(){FB.api("me?fields=age_range,first_name,last_name,gender,picture.type(large),id,email",function(e){if(e&&!e.error){var a=e.id;t.fn=v(e.first_name)?e.first_name:"",t.ln=v(e.last_name)?e.last_name:"",t.age_range=parseInt(e.age_range.min),t.gender=v(e.gender)?e.gender:"",t.pic_url="https://graph.facebook.com/"+a+"/picture?type=large",t.email=v(e.email)?e.email:"",null==a||void 0==a||v(t.age_range)===!1||(o.getFBUserSignedIn(a,t.fn,t.ln,t.age_range,t.gender,t.pic_url,t.email),o.send().then(function(e){if(e.data)switch(e.data.status){case"OK":c.setAt(e.data.at),c.setRt(e.data.rt),$("#signin-modal").modal("hide");try{var a=c.getUser()}catch(n){c.logOut()}void 0!==a&&null!=a?(t.send(a.picture_url),$(".imgpanel").show(),$(".horizontal-menu").show(),s.go("home")):localStorage.clear();break;case"U":f=e.data.data,$("#fb-signup-modal").modal("show");break;case"IA":t.unknown_error=!1,t.age_error=!0,p();break;case!1:t.unknown_error=!0,t.age_error=!1,p()}else t.unknown_error=!0,t.age_error=!1,p()},function(e){t.unknown_error=!0,t.age_error=!1,p()}))}else FB.login(function(e){e.authResponse?m():$("#fb-signin-request-modal").modal("show")})})},p=function(){$("#fb-signup-modal").modal("hide"),$("#message-modal").modal("show")};t.submitDetails=function(){t.user_error=!1,f>0&&null!=f?v(t.signup.username)&&v(t.signup["class"])&&v(t.signup.school)&&v(t.signup.department)&&v(t.signup.phone)&&(o.setFBUserDetailsUpdate(t.signup.username,f,t.signup["class"],t.signup.school,t.signup.department,t.signup.phone),o.send().then(function(e){if("OK"==e.data.status){c.setAt(e.data.at),c.setRt(e.data.rt),$("#fb-signup-modal").modal("hide");try{var n=c.getUser()}catch(r){c.logOut()}void 0!==n&&null!=n?(t.send(n.picture_url),$(".imgpanel").show(),$(".horizontal-menu").show(),s.go("home"),a.isnew=!0):localStorage.clear()}else"U"==e.data.status?t.user_error=!0:e.data.status===!1?(t.unknown_error=!0,t.age_error=!1,p()):(t.unknown_error=!0,t.age_error=!1,p())},function(e){t.unknown_error=!0,t.age_error=!1,p()})):(t.unknown_error=!0,t.age_error=!1,p())},t.signup={username:void 0,school:void 0,"class":void 0,department:void 0,phone:void 0},t.signupmail={username:void 0,school:void 0,"class":void 0,department:void 0,password:void 0,repassword:void 0,email:void 0,school:void 0,phone:void 0},t.signin={email:void 0,password:void 0},t.setUserClass=function(e){t.signupmail["class"]=e,t.signup["class"]=e},t.setUserDepartment=function(e){t.signup.department=e},t.studentsignup=function(){var e={username:t.signupmail.username,firstname:t.signupmail.firstname,lastname:t.signupmail.lastname,password:t.signupmail.password,repassword:t.signupmail.repassword,department:t.signupmail.department,email:t.signupmail.email,skul:t.signupmail.school,klas:t.signupmail["class"],phone:t.signupmail.phone};w(e.username)||w(e.email)||w(e.firstname)||w(e.lastname)||w(e.password)||w(e.repassword)?h("Complete All fields appropriately"):e.password==e.repassword&&e.phone.length>=11?(o.make(e,"endpoints/signup.php"),o.send().then(function(e){200==e.status&&(console.log(e.data),200==e.data.status&&"OK"==e.data.data?($("#signup-modal").modal("hide"),$("#success-signup-modal").modal("show")):200==e.data.status&&"EE"==e.data.data?h("We could not send you a mail a this moment. please make sure the email address is in use and is working."):401==e.data.status?("E"==e.data.data&&h("a user with that email address exists."),"U"==e.data.data&&h("a user with that username exists."),"P"==e.data.data&&h("a user with that phone number exists."),"IE"==e.data.data&&h("Please enter a valid email address to continue.")):h("An Error occurred while attempting to sign you up. please try again later."))},function(e){h("An Error occurred while attempting to sign you up. please try again later.")})):h("please make sure the passwords you entered match each other and that you have entered a valid phone number.")},t.send=function(e){r.sendData(e)},t.studentsignin=function(){var e={namemail:t.signin.email,password:t.signin.password};w(e.namemail)||w(e.password)?g("Complete All fields appropriately"):(o.make(e,"endpoints/login.php"),o.send().then(function(e){if(200==e.status)if("OK"==e.data.status){c.setAt(e.data.at),c.setRt(e.data.rt),$("#signin-modal").modal("hide");try{var n=c.getUser()}catch(r){c.logOut()}void 0!==n&&null!=n?(t.send(n.picture_url),$(".imgpanel").show(),$(".horizontal-menu").show(),s.go("home"),e.data.data===!0?a.isnew=!0:a.isnew=!1):localStorage.clear()}else"INV"==e.data.status?g("The password you entered does not match your email address/username."):"EMP"==e.data.status?g("Please enter a valid username/email address and password."):"ERR"==e.data.status?g("An error occurred while attempting to sign you in. please try again later or sign in with facebook."):"ACT"==e.data.status&&g("We see you have signed up. A mail was sent to the email you provided us, Please follow the link in the mail.")},function(e){g("An error occurred while attempting to sign you in. please try again later or sign in with facebook.")}))},t.gotoLLH=function(){};var h=function(e){t.signup_message=e};t.showsignUp=function(){h(""),$("#signup-modal").modal("show")};var g=function(e){t.signin_message=e};t.showsignIn=function(){g(""),$("#signin-modal").modal("show")};var v=function(e){return e!==!1&&void 0!=e&&null!=e&&""!=e?!0:!1}}]),myApp.service("showAbout",[function(){this.showAbout=function(){window.location.href="https://www.geniusesafrica.com/quickabout.html"}}]),myApp.controller("newusercontroller",["$scope","service","getSchools","setUserRequest","responseReview","textInterval","authService",function(e,t,a,n,s,r,o){function d(e,t){return e.indexOf(t)>=0}e.searchparamater="school",e.name="",e.school="",e.content=!1;var i=!1;e.count=0,e.limit=50,e.selected_user_ids=[],e.user_name=o.getUser().firstname,e.data={firstname:void 0,lastname:void 0,offset:e.count},e.value_entered=null,$(".timed-text").hide(),o.isLoggedIn()&&(t.setSchools(),t.send().then(function(t){if(s.check(t.data)){var a=t.data.data;e.schools=a.sort()}},function(e){})),e.setSchool=function(t){e.value_entered=e.schools[t]},e.setSearchParameter=function(t){e.searchparamater=t},e.searchforSchoolorName=function(){if(null!=e.value_entered&&i===!1&&("school"==e.searchparamater&&e.value_entered.length>0&&(e.school=e.value_entered,l()),"name"==e.searchparamater&&e.value_entered.length>0)){var t=e.value_entered;t=t.split(" "),2==t.length&&(e.data.firstname=t[0],e.data.lastname=t[1],u()),1==t.length&&(e.data.firstname=t[0],e.data.lastname="",u()),(null==t||0==t.length)&&(e.data.firstname="",e.data.lastname="")}};var l=function(){t.setSearchSchools(e.school,e.limit),t.send().then(function(t){s.check(t.data)&&(t.data.data?(e.content=!0,e.users=t.data.data,e.limit+=50):e.content=!1)},function(e){})},u=function(){e.data.offset=e.count,t.setGetUsers(e.data.firstname,e.data.lastname,e.data.offset)&&t.send().then(function(t){s.check(t.data)&&(t.data.data?(e.content=!0,e.users=t.data.data,e.count+=50):e.content=!1)},function(e){})};e.sendBatchRequests=function(){if(!$.isEmptyObject(e.selected_user_ids)&&i===!1){i=!0;var a=e.selected_user_ids;t.setBatchRequest(a),t.send().then(function(e){e.data.data===!0&&(c(),r.showText()),s.check(e.data),i=!1},function(e){i=!1})}},e.$on("user-request",function(){var t=n.getRequest();d(e.selected_user_ids,t)?e.selected_user_ids=e.selected_user_ids.splice(0,e.selected_user_ids.indexOf(t)):e.selected_user_ids.push(t)});var c=function(){e.name="",e.school="",e.content=!1,i=!1,e.count=0,e.limit=50,e.selected_user_ids=[],e.data={firstname:void 0,lastname:void 0,offset:e.count},e.value_entered=null}}]),myApp.service("getSchools",["$q","$http",function(e,t){this.getSchoolsHttp=function(a){data={method:"getSchools"};var n=a,s=e.defer();return $(".spinner-div").show(),t.post(n,data).then(function(e){s.resolve(e),$(".spinner-div").fadeOut()},function(){s.reject(!1),$(".spinner-div").fadeOut()}),s.promise}}]),myApp.factory("setUserRequest",["$rootScope",function(e){var t={};return t.request=!1,t.sendData=function(t){this.request=t,e.$broadcast("user-request")},t.getRequest=function(){return this.request},t}]),myApp.factory("textInterval",["$interval",function(e){var t={};return t.showText=function(){$(".timed-text").fadeIn(),e(function(){$(".timed-text").fadeOut(),e.cancel()},4e3)},t}]);