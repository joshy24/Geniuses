myApp.controller("TopAppController",["$scope","$state","currentUser","service","responseReview","requestsService","logout","authService",function(e,t,n,a,s,o,r,i){if(e.user_name="",e.loggedIn=!1,i.isLoggedIn()){var l=i.getUser();e.user_name=l.firstname,e.loggedIn=!0,l.picture_url?$("#profileimage").attr("src",l.picture_url):$("#profileimage").attr("src","img/defaultwhite.png")}else $("#profileimage").attr("src","img/defaultwhite.png");e.showProfile=function(){if(i.isLoggedIn()){if("user"!=t.current){var e=i.getUser().id;t.go("user",{id:e})}}else t.go("login")},e.showAccount=function(){i.isLoggedIn()?"profile"!=t.current&&t.go("profile"):i.logOut()},e.logOut=function(){a.setLogOut()===!0&&a.send().then(function(e){s.check(e.data)},function(e){}),d("logout"),$("#profileimage").attr("src","img/defaultwhite.png"),e.loggedIn=!1,e.user_name="",$(".horizontal-menu").hide(),localStorage.clear(),t.go("login")};var u=function(){null!=e.received?$("#notificationsModal").modal("show"):(e.message="you dont have any notifications at this moment",$("#notificationsModal").modal("show"))};e.showNotifications=function(){u()},e.$on("current_user",function(){if(1==i.isLoggedIn()){var a=i.getUser();c(),e.user_name=a.firstname,e.loggedIn=!0;var s=n.getData();if(void 0!=s&&s.length>0){var o=s;$("#profileimage").attr("src",o)}}else $("#profileimage").attr("src","img/defaultwhite.png"),e.user_name="",e.loggedIn=!1,t.go("login")});var d=function(e){r.sendData(e)};e.$on("logout",function(){1==i.isLoggedIn()?(a.setLogOut()===!0&&a.send().then(function(e){s.check(e.data)},function(e){}),$(".horizontal-menu").hide(),$("#profileimage").attr("src","img/defaultwhite.png"),e.loggedIn=!1,e.user_name=""):t.go("login")});var c=function(){if(i.isLoggedIn()){o.getRequests();a.setNotofication(),a.send().then(function(n){200==n.status&&1==s.check(n.data)&&(0!=n.data.data1&&null!=n.data.data1?(e.received=n.data.data1,e.sent=n.data.data1,e.notification_count=n.data.data1.length,f(),console.log(t.current.name),null!=e.received&&(""==t.current.name.trim()||"home"==t.current.name)&&u()):e.notification_count=0)},function(e){})}};e.$on("requestschange",function(){var t=o.getRequests();t===!1||$.isEmptyObject(t)?(e.received=[],e.notification_count=0):(e.received=t,e.notification_count=t.length,f())});var f=function(){for(var t=0;t<e.received.length;t++)""==e.received[t].picture_url.trim()&&(e.received[t].picture_url="img/default.png")};e.showFriendProfile=function(e){$("#notificationsModal").modal("hide"),t.go("user",{id:e})},e.showFriends=function(){$("#notificationsModal").modal("hide"),t.go("friends")},c()}]);